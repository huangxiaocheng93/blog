我们已经知道了TCP/IP协议簇把网络划分成了五层，但是TCP/IP并没有直接定义物理层和数据链路层，这两层对TCP/IP来说是透明的，接下来我们就来看看这两层分别在做什么。

# 物理层

在计算机网络中，物理层是最具象化的一层了，很多东西都是我们能看得见摸得着的东西，例如我们的网线等等。

## 物理层的职责

### 定义物理元器件
物理元器件例如：RJ45接口（网线插口）、水晶头、双绞线（网线）等等，所有这些元器件都需要有规范，厂商根据规范生产，这样才能保证兼容性。

### 定义网络连接方式
例如星型，总线型，环形，现代互联网几乎都是星型结构了，其他类型看看就算了。

### 数据处理
我们知道物理层使用高低电平来传递信号，10101转换为电信号就是“高低高低高”，试想一下，如果传递的信号时1111111111呢？物理层如果连续发出10个高电平，那就相当于高电平连在一起了，怎么保证接收端收到的时10个1而不是9个或者11个呢？所以为了应对这个问题，物理层还需要使用一些其他的手段来解决这个问题。

1. **编码**：针对上面场景连续的1，我们可以在每个高电平上做一些变化，例如依次递增，这样接收端就可以清晰的识别到信号的边界，不会数错个数啦，这种编码方式叫做**曼彻斯特编码**；
2. **时钟同步**：举个例子，如果我们在10个连续的1后面插入一个信号，告诉接收端，你前面数完了10个数字，那这样接收端就一定不会数错了；
3. **信号间隔**：问题主要原因还是连续的1太多了，如果我们在中间插入间隔信号，不要让这么多连续的1在一起，那么问题就会得到比较大的缓解了；

### 调制和解调
我们知道数据在计算机中的最终形态是0和1，在将数据发送出去的时候必须要转换成传输介质能传输的信号，例如双绞线可以传输的电信号，这个转换过程叫做**调制**；那么反过来，将电信号转换为计算机认识的数据的过程就叫做**解调**。

> [!TIP]
> 根据传输介质的不同，**调制**出来的还分为数字信号和模拟信号，关于它们的差别先不扩展了。

### 数据传输
物理层也要解决信号在传输过程中的问题。以双绞线为例，我们都知道导线都是由电阻的，电压在经过一段导线以后，一定会有所降低，如果高电平降低到了临界值，我们如何判断他是高电平还是低电平呢？
这实际上就是为什么网线不能拉太远的原因，如果非要拉的很远怎么办，第一可以换用更高规格的网线，更高规格的网线信号的损失会更小；第二使用**中继器**等工作在物理层的设备在中间对电信号做一次放大，这样信号就能传递到更远的地方了。

# 数据链路层

物理层解决了数据和电信号之间的转换问题、信号在介质中传输的问题，那么数据链路层在解决什么问题呢？

## 什么是数据链路

数据链路是一个逻辑概念，我总结了一下：当几台主机通过网线直接连接，或者通过工作在物理层或者数据链路层的设备连接在一起时，那么这几台主机就组成一个数据链路，他们在同一个数据链路内。
数据链路是网络的最小组成单元。

## 数据链路层的职责

**数据链路层的职责就是保证在同一个数据链路内，数据能正确的送达到目标主机。**
为了达到这个目的，数据链路层要解决下面的这几个问题：

1. 主机的唯一ID，数据链路内的主机必须要有一个自己的唯一标识，这样我们才能分辨谁是谁，不至于把数据送错地方；
2. 数据封装：数据包要封装成适合在线路上传输的大小然后再传输；
3. 可靠传输：确保数据都发送出去了，确保接收端都收到了
4. 差错控制：确保接收端收到的数据是对的；
5. 传输介质管理，如果多台主机共用传输介质，路只有一条，谁先走谁后走，要商量着来；

## MAC地址

数据链路层，为了解决主机唯一ID的问题，使用的是MAC地址。

MAC地址是主机在数据链路层的唯一标识。这个标识来源于网卡，是在网卡出厂的时候烧入ROM里面的，是硬件级别的地址，不可能发生改动的，就是网卡的身份证，任何一个网卡的MAC地址在全球都是唯一的（当然也有例外，例如虚拟机的MAC地址，但有一点，同一个网络内，MAC地址肯定是不重复的）。

MAC地址总共使用6个字节标识，日常一般都使用16进制标识，并且2位一组，总共6组，使用短横线连接，示例如下：

![image](https://github.com/user-attachments/assets/2fda03f6-fb44-4a31-a108-ad5641e95943)

拆开为2进制来看，结构是这样子的：

![image](https://github.com/user-attachments/assets/359ba850-bb86-44b2-8c69-12cffe487900)

分为两大部分：
第一部分为厂商识别码，由IEEE颁发的厂商编号，IEEE保证此编号不重复，共占用3个字节；第二部分为厂商内编码，由厂商保证自己内部内部不重复。
在厂商识别码的第一个字节中有两位比较特殊，如图所示：
- 单播/广播标识，占1位，0为单播地址，1为多播地址；
- 全局/本地地址，占1位，0为全局地址，1为本地地址；
这两位IEEE分配的时候默认会是0。

了解完上述规格，应该非常容易理解MAC地址为什么不会重复了。

## MAC地址的使用

下面我们来看看在数据链路内，消息是如何送到目标主机的：

![image](https://github.com/user-attachments/assets/73202f17-7d01-4d4c-ab81-8390d1ba7301)

数据链路内的每一台主机都会收到这个数据帧，他们会通过消息中设置的目标MAC地址来判断此数据帧是不是发送给自己的，如果是就接收，不是则丢弃。

> [!TIP]
> 图示是一个总线型网络，在当下的互联网，这种结构几乎不见了，但是为了说明在没有其他数据链路层设备参与的情况下，数据会怎么发送，所以用这个结构作为示例。

## 数据封装

在数据链路层，数据不再是一个个的高低电平了，而是一段数据封装起来，叫做数据帧。

// todo

## 数据链路的网络类型

### 共享介质型网络

上图所示的这种网络连接类型叫做**总线型**，是**共享介质型网络**。这种连接方式是比较早期的互联网连接方式，但是现在基本已经很少见了。这种连接方式会有很多问题，例如：

> [!TIP]
> 这里所说的共享介质型网络的介质指的是传输介质，也就是网线，意思就是多台主机贡献同一个传输介质；
- 一个数据帧，所有的主机都会收到，但是实际上只有一台是目标主机，这中间就会有很大的浪费；
- 一个数据链路内同时只能有一台主机在发送数据，其他主机都必须等着，所以在主机之间还必须协商介质的访问，效率也低；

> [!TIP]
这里结合物理层就比较好理解，如果不同主机同一时间在同一条线路上发送电信号，那肯定就乱套了，所以还必须解决冲突，解决的方式有两种，一种是争用，一种是令牌传递。
> 

**总线型**网络存在与同轴线时代，只能实现半双工通信，而且还要做介质访问控制，现在已经比较少见了。

> [!NOTE]
> 半双工通信指的是在同一时间内只能发送或者只能接收的通信方式，比较典型的例子就是对讲机；全双工通信指的是在同一时间内可以同时发送和接收，例如电话，可以两个人同时讲话。

### 非共享介质型网络

现代互联网的形态很多的是这种**星型**结构，所有的主机都连接到交换机，通过交换机间接的连接到一起。使用的传输介质也从同轴线进化到了双绞线。

![image](https://github.com/user-attachments/assets/95742ac6-d6dc-4c95-97d7-821feae540cd)

> [!TIP]
> 同轴线里面只有一根比较粗的线，所以很明显同一时间只能传递一个信号，最近见到的应该就是以前广电有线电视的线材，试想一下，有线电视是不是就是典型的半双工场景？双绞线里面一共4股共8根线，只需要对这8根线的功能进行定义，就能轻轻松松实现同时传递多个信号了。

可以看到，在星型网络结构里面，交换机起了非常重要的作用，每台主机都连接到交换机，交换机在中间分发数据，也就是交换。

这种结构下，主机就不用去争用介质了，只需要直接把数据发送出去即可，也不会无缘无故收到不属于自己的数据，交换机会负责分发（当然也有例外，后面交换机的部分再细说）。

### 交换机

上面说到的交换机，因为是工作在第二层（数据链路层），所以我们也叫他二层交换机。

![image](https://github.com/user-attachments/assets/8afbf7ea-6de3-4092-b3fd-0f323e394429)

> [!TIP]
我们常说的交换机就是二层交换机，也叫做网桥，两个网络之间的桥梁，很形象。也是集线器的一种，有交换功能的集线器就是二层交换机，可以同时工作在一层和二层；没有交换功能的集线器就叫集线器或者中继器（物理层时有说到），只工作在一层。
> 

交换机的职责就很清晰了，接收主机发送过来的数据帧，转发给目标主机。

一般交换机还会有自学习的能力：

- 当交换机不知道网口关联的MAC地址时，它也只能把数据帧投递给所有非发送端的网口，这种发送方式叫做广播，广播能达到的链路就是这个数据链路的**广播域**；
- 同时它会把发送端的MAC地址和网口关联起来，下次如果有其他主机发送数据给这个MAC地址，那么交换机就会直接把数据帧投递到这个网口，这就是交换机的自学习能力。

> [!IMPORTANT]
> 那么问题来了：通过交换机连接起来的主机，还在同一个数据链路中吗？

只要还在数据链路的广播域内，就可以认为是同一个数据链路。如果我们不考虑网络层的影响，我们可以认为交换机连接的主机还是在同一个数据链路内的。

关联：
[TCP/IP协议系列之网络基础](https://huangxiaocheng93.github.io/blog/post/TCP-IP-xie-yi-xi-lie-zhi-wang-luo-ji-chu.html)